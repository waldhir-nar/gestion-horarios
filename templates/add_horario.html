<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Horarios</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='add_form.css') }}">
</head>
<body>

<div class="container">
    
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flashes">
        {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <h1>1. Crear Nuevo Horario</h1>
    <form action="{{ url_for('horarios_bp.crear_cronograma') }}" method="POST">
        <div class="form-row">
            <label for="nombre_cronograma">Nombre del Horario:</label>
            <input type="text" id="nombre_cronograma" name="nombre_cronograma" placeholder="Ej: Horario Semestre 2025-II" required>
        </div>
        <div class="form-row">
            <label for="id_curso_form1">Asociar al Curso:</label>
            <select name="id_curso" id="id_curso_form1" required>
                <option value="">-- Seleccione un curso --</option>
                {% for curso in cursos %}
                    <option value="{{ curso.id_curso }}">{{ curso.nombre }}</option>
                {% endfor %}
            </select>
        </div>
        <button class="btn" type="submit">Crear Horario</button>
    </form>

    <hr style="margin: 40px 0;">

    <h1>2. Agregar Clase a un Horario Existente</h1>
    <p>La validación completa (curso y semestre) se realiza al guardar.</p>

    <form action="{{ url_for('horarios_bp.crear_horario') }}" method="POST">

        <div class="form-row">
            <label for="id_cronograma_form2">Horario:</label>
            <select name="id_cronograma" id="id_cronograma_form2" required>
                <option value="">-- Seleccione un horario --</option>
                {% for cronograma in cronogramas %}
                     <option value="{{ cronograma.id_cronograma }}">{{ cronograma.nombre }} ({{ cronograma.curso_nombre or 'General' }})</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-row">
            <label for="id_semestre">Semestre:</label>
            <select name="id_semestre" id="id_semestre" required>
                <option value="">-- Seleccione un semestre --</option>
                {% for semestre in semestres %}
                    <option value="{{ semestre.id_semestre }}">{{ semestre.nombre }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-row">
            <label for="id_profesor">Profesor:</label>
            <select name="id_profesor" id="id_profesor" required>
                <option value="">-- Seleccione un profesor --</option>
                {% for profesor in profesores %}
                    <option value="{{ profesor.id_profesor }}">{{ profesor.nombre }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-row">
            <label for="id_clase">Clase/Asignatura:</label>
            <select name="id_clase" id="id_clase" required>
                <option value="">-- Primero seleccione un profesor --</option>
            </select>
        </div>

        <div class="form-row">
            <label for="dia">Día:</label>
            <select name="dia" id="dia" required>
                <option value="Lunes">Lunes</option>
                <option value="Martes">Martes</option>
                <option value="Miércoles">Miércoles</option>
                <option value="Jueves">Jueves</option>
                <option value="Viernes">Viernes</option>
                <option value="Sábado">Sábado</option>
            </select>
        </div>

        <div class="form-row">
            <label for="h_inicio">Hora Inicio:</label>
            <input type="time" id="h_inicio" name="h_inicio" required>
        </div>
        
        <div class="form-row">
            <label for="h_fin">Hora Fin:</label>
            <input type="time" id="h_fin" name="h_fin" required>
        </div>

        <button class="btn btn-success" type="submit">Agregar Entrada al Horario</button>
    </form>

    <a href="{{ url_for('horarios_bp.lista_horarios') }}" class="back-link">Volver a la lista de horarios</a>
</div>

<script>
    const todasLasClases = {{ clases | tojson }};
    const profesorSelect = document.getElementById('id_profesor');
    const claseSelect = document.getElementById('id_clase');

    profesorSelect.addEventListener('change', function() {
        const idProfesorSeleccionado = this.value;
        claseSelect.innerHTML = '<option value="">-- Seleccione una clase --</option>';
        if (idProfesorSeleccionado) {
            const clasesDelProfesor = todasLasClases.filter(clase => clase.id_profesor == idProfesorSeleccionado);
            clasesDelProfesor.forEach(clase => {
                // --- MODIFICACIÓN: Mostrar curso y semestre para dar contexto completo ---
                const curso = clase.curso_nombre || 'N/A';
                const semestre = clase.semestre_nombre || 'N/A';
                const optionText = `${clase.nombre} (Curso: ${curso} / Sem: ${semestre})`;
                const option = new Option(optionText, clase.id_clase);
                claseSelect.add(option);
            });
        }
    });
</script>

</body>
</html>
