<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horarios Guardados - UPCA</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='gestion.css') }}">
</head>
<body>
    <header>
        <h1>Sistema de Gestión de Horarios</h1>
        <nav>
            <ul>
                <li><a href="{{ url_for('index') }}" class="boton-nav">Inicio</a></li>
                <li><a href="{{ url_for('horarios_bp.lista_horarios') }}" class="boton-nav active">Horarios</a></li>
                <li><a href="{{ url_for('profesores_bp.lista') }}" class="boton-nav">Profesores</a></li>
                <li><a href="{{ url_for('cursos_bp.lista') }}" class="boton-nav">Cursos</a></li>
                <li><a href="{{ url_for('gestion_bp.gestion') }}" class="boton-nav">Gestion-H</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <h1>Horarios Guardados</h1>
        
        <div class="acciones">
            <a href="{{ url_for('horarios_bp.add_horario_form') }}" class="btn btn-danger">Añadir Entrada Manual</a>
            <a href="{{ url_for('horarios_bp.crear_horario_auto_form') }}" class="btn btn-danger">Generar Horario Automático</a>
        </div>
        <br>

        <!-- Contenedor principal que ahora apilará las tarjetas verticalmente -->
        <div class="horarios-lista-vertical">
            {% if horarios_guardados %}
                {% for id_c, horario in horarios_guardados.items() %}
                    <!-- Cada horario es una "tarjeta" separada -->
                    <div class="horario-card">
                        <div class="horario-header">
                            <div>
                                <h2>{{ horario.nombre }}</h2>
                                <p>
                                    <strong>Curso:</strong> {{ horario.curso_nombre or 'N/A' }} |
                                    <strong>Semestre:</strong> {{ horario.semestre_nombre or 'N/A' }}
                                </p>
                            </div>
                            <form action="{{ url_for('horarios_bp.delete_horario', id_cronograma=horario.id_cronograma) }}" method="post" onsubmit="return confirm('¿Estás seguro de que quieres eliminar este horario?');">
                                <button type="submit" class="btn btn-danger">Eliminar</button>
                            </form>
                        </div>
                        
                        {% if horario.grid %}
                            <div class="table-responsive">
                                <table class="schedule-table">
                                    <thead>
                                        <tr>
                                            <th>Hora</th>
                                            {% for day in horario.days_of_week %}
                                                <th>{{ day }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for hour in horario.sorted_hours %}
                                            <tr>
                                                <td>{{ hour }}</td>
                                                {% for day in horario.days_of_week %}
                                                    <td>
                                                        {% set detalle = horario.grid[hour][day] %}
                                                        {% if detalle %}
                                                            <strong>{{ detalle.clase_nombre }}</strong><br>
                                                            <small>{{ detalle.profesor_nombre }}</small>
                                                        {% else %}
                                                            &nbsp;
                                                        {% endif %}
                                                    </td>
                                                {% endfor %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <p class="aviso">Este horario aún no tiene clases asignadas.</p>
                        {% endif %}
                    </div>
                {% endfor %}
            {% else %}
                <p>No hay horarios guardados.</p>
            {% endif %}
        </div>
    </div>
</body>
</html>
